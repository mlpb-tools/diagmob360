<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diag'Mob 360¬∞ - Diagnostic mobilit√© complet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Nunito:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        .font-montserrat { font-family: 'Montserrat', sans-serif; }
        .font-nunito { font-family: 'Nunito', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #7A1A7A 0%, #E61D72 50%, #3BA4E0 100%); }
        .progress-bar { 
            background: linear-gradient(90deg, #3BA4E0 0%, #7AC143 100%);
            transition: width 0.8s ease;
        }
        .card-hover { 
            transition: all 0.3s ease; 
            cursor: pointer;
        }
        .card-hover:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); 
        }
        .option-selected {
            background: linear-gradient(135deg, #7A1A7A, #E61D72);
            color: white;
            transform: scale(1.02);
        }
        .scale-option {
            transition: all 0.2s ease;
        }
        .scale-option:hover {
            transform: scale(1.05);
        }
        .domain-icon {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border: 2px solid #d1d5db;
        }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .radar-container { position: relative; width: 400px; height: 400px; margin: 0 auto; }

    </style>
</head>
<body class="bg-gray-50 min-h-screen font-nunito">
    
    <!-- Page de garde -->
    <div id="welcome-page" class="min-h-screen flex flex-col">
        <div class="gradient-bg h-3"></div>
        
        <div class="flex-1 flex items-center justify-center p-6">
            <div class="text-center max-w-4xl">
                <div class="mb-8">
                    <h1 class="text-6xl md:text-7xl font-montserrat font-bold text-purple-800 mb-4">
                        Diag'Mob 360¬∞
                    </h1>
                    <h2 class="text-3xl md:text-4xl font-montserrat font-semibold text-pink-600 mb-6">
                        Diagnostic mobilit√© complet
                    </h2>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed mb-8">
                        Un outil technique et complet pour √©valuer tous les aspects de ta mobilit√© : 
                        transport, financement, comp√©tences, sant√©, social et projets personnels.
                    </p>
                </div>

                <!-- Domaines couverts -->
                <div class="bg-white rounded-3xl p-8 shadow-xl mb-8">
                    <h3 class="text-2xl font-montserrat font-bold text-purple-800 mb-6">8 Domaines analys√©s</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        <div class="text-center">
                            <div class="w-20 h-20 domain-icon rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-3xl">üó∫Ô∏è</span>
                            </div>
                            <p class="font-semibold text-gray-800">G√©ographie</p>
                            <p class="text-xs text-gray-500">Environnement & localisation</p>
                        </div>
                        <div class="text-center">
                            <div class="w-20 h-20 domain-icon rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-3xl">üöó</span>
                            </div>
                            <p class="font-semibold text-gray-800">Transport</p>
                            <p class="text-xs text-gray-500">Moyens & accessibilit√©</p>
                        </div>
                        <div class="text-center">
                            <div class="w-20 h-20 domain-icon rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-3xl">üß†</span>
                            </div>
                            <p class="font-semibold text-gray-800">Comp√©tences</p>
                            <p class="text-xs text-gray-500">Savoir-faire mobilit√©</p>
                        </div>
                        <div class="text-center">
                            <div class="w-20 h-20 domain-icon rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-3xl">üíö</span>
                            </div>
                            <p class="font-semibold text-gray-800">Sant√©</p>
                            <p class="text-xs text-gray-500">Physique & psychologique</p>
                        </div>
                        <div class="text-center">
                            <div class="w-20 h-20 domain-icon rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-3xl">üí∞</span>
                            </div>
                            <p class="font-semibold text-gray-800">Financement</p>
                            <p class="text-xs text-gray-500">Budget & aides</p>
                        </div>
                        <div class="text-center">
                            <div class="w-20 h-20 domain-icon rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-3xl">üë•</span>
                            </div>
                            <p class="font-semibold text-gray-800">Social</p>
                            <p class="text-xs text-gray-500">R√©seau & soutien</p>
                        </div>
                        <div class="text-center">
                            <div class="w-20 h-20 domain-icon rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-3xl">‚ö†Ô∏è</span>
                            </div>
                            <p class="font-semibold text-gray-800">Contraintes</p>
                            <p class="text-xs text-gray-500">Barri√®res externes</p>
                        </div>
                        <div class="text-center">
                            <div class="w-20 h-20 domain-icon rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="text-3xl">üéØ</span>
                            </div>
                            <p class="font-semibold text-gray-800">Projets</p>
                            <p class="text-xs text-gray-500">Aspirations & objectifs</p>
                        </div>
                    </div>
                </div>

                <!-- Avantages techniques -->
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-blue-50 rounded-2xl p-6 border-2 border-blue-200">
                        <div class="text-4xl mb-4">üî¨</div>
                        <h4 class="font-montserrat font-bold text-blue-800 mb-2">Analyse technique</h4>
                        <p class="text-sm text-blue-600">Scoring algorithmique et logique conditionnelle avanc√©e</p>
                    </div>
                    <div class="bg-green-50 rounded-2xl p-6 border-2 border-green-200">
                        <div class="text-4xl mb-4">üìä</div>
                        <h4 class="font-montserrat font-bold text-green-800 mb-2">Profil 360¬∞</h4>
                        <p class="text-sm text-green-600">Radar complet avec recommandations personnalis√©es</p>
                    </div>
                    <div class="bg-purple-50 rounded-2xl p-6 border-2 border-purple-200">
                        <div class="text-4xl mb-4">üì±</div>
                        <h4 class="font-montserrat font-bold text-purple-800 mb-2">Interface adaptative</h4>
                        <p class="text-sm text-purple-600">Compatible tous supports avec navigation fluide</p>
                    </div>
                </div>

                <button onclick="startDiagnostic()" class="gradient-bg text-white px-12 py-6 rounded-full text-2xl font-montserrat font-bold hover:shadow-2xl transition-all duration-300 transform hover:scale-105 pulse">
                    üöÄ Lancer le diagnostic 360¬∞
                </button>
                <p class="text-sm text-gray-500 mt-4">‚è±Ô∏è Dur√©e : 15-20 minutes ‚Ä¢ üìä 50+ questions ‚Ä¢ üéØ Analyse compl√®te</p>
            </div>
        </div>
    </div>

    <!-- Pages de questions -->
    <div id="question-pages" class="hidden min-h-screen">
        <!-- Header avec progression -->
        <div class="bg-white shadow-lg sticky top-0 z-20">
            <div class="gradient-bg h-3"></div>
            <div class="max-w-6xl mx-auto p-4">
                <div class="flex justify-between items-center mb-3">
                    <div>
                        <h2 class="text-xl font-montserrat font-bold text-purple-800">Diag'Mob 360¬∞</h2>
                        <div id="domain-title" class="text-base font-semibold text-pink-600"></div>
                    </div>
                    <div class="text-right">
                        <div id="progress-text" class="text-base font-bold text-purple-800">Question 1/50</div>
                        <div id="step-indicator" class="text-sm text-gray-600">√âtape 1/8</div>
                    </div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3 shadow-inner">
                    <div id="progress-bar" class="progress-bar h-3 rounded-full shadow-sm" style="width: 2%"></div>
                </div>
            </div>
        </div>

        <!-- Contenu des questions -->
        <div class="max-w-5xl mx-auto p-6">
            <div id="question-container" class="bg-white rounded-3xl shadow-xl p-10 mb-8 border border-gray-100">
                <!-- Questions dynamiques -->
            </div>

            <!-- Navigation -->
            <div class="flex justify-between items-center">
                <button id="prev-btn" onclick="previousQuestion()" class="bg-gray-200 text-gray-700 px-10 py-5 rounded-full font-bold hover:bg-gray-300 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg" disabled>
                    ‚¨ÖÔ∏è Pr√©c√©dent
                </button>
                <div class="text-center">
                    <div id="question-counter" class="text-lg font-semibold text-gray-600">1 sur 50</div>
                    <div class="text-sm text-gray-500 mt-1">Questions restantes : <span id="remaining-questions">49</span></div>
                </div>
                <button id="next-btn" onclick="nextQuestion()" class="gradient-bg text-white px-10 py-5 rounded-full font-bold hover:shadow-xl transition-all shadow-lg">
                    Suivant ‚û°Ô∏è
                </button>
            </div>
        </div>
    </div>

    <!-- Page profil -->
    <div id="profile-page" class="hidden min-h-screen">
        <div class="gradient-bg h-3"></div>
        <div class="max-w-7xl mx-auto p-6">
            <!-- En-t√™te profil -->
            <div class="text-center mb-10">
                <h2 class="text-5xl font-montserrat font-bold text-purple-800 mb-6">Ton Profil Mobilit√© 360¬∞</h2>
                <div id="profile-badge" class="inline-block gradient-bg text-white px-10 py-6 rounded-full text-3xl font-montserrat font-bold mb-6 shadow-2xl">
                    <!-- Profil dynamique -->
                </div>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">Analyse compl√®te de tes 8 domaines de mobilit√©</p>
            </div>

            <!-- Contenu profil -->
            <div class="grid lg:grid-cols-2 gap-10 mb-10">
                <!-- Graphique radar -->
                <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100">
                    <h3 class="text-3xl font-montserrat font-bold text-purple-800 mb-8 text-center">Radar Mobilit√© 360¬∞</h3>
                    <div class="radar-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>

                <!-- Scores d√©taill√©s -->
                <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100">
                    <h3 class="text-3xl font-montserrat font-bold text-purple-800 mb-8">Scores par domaine</h3>
                    <div id="domain-scores" class="space-y-4">
                        <!-- Scores dynamiques -->
                    </div>
                </div>
            </div>

            <!-- Recommandations -->
            <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100 mb-10">
                <h3 class="text-3xl font-montserrat font-bold text-purple-800 mb-8">Recommandations personnalis√©es</h3>
                <div id="recommendations-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Recommandations dynamiques -->
                </div>
            </div>

            <!-- Actions -->
            <div class="text-center">
                <button onclick="showReport()" class="gradient-bg text-white px-12 py-6 rounded-full text-2xl font-montserrat font-bold hover:shadow-2xl transition-all mr-4">
                    üìä Voir le bilan complet
                </button>
                <button onclick="downloadAdvancedPDF()" class="bg-blue-600 text-white px-12 py-6 rounded-full text-2xl font-montserrat font-bold hover:bg-blue-700 transition-all">
                    üìÑ T√©l√©charger PDF technique
                </button>
            </div>
        </div>
    </div>

    <!-- Page bilan -->
    <div id="report-page" class="hidden min-h-screen">
        <div class="gradient-bg h-3"></div>
        <div class="max-w-6xl mx-auto p-6">
            <!-- En-t√™te bilan -->
            <div class="text-center mb-10">
                <h2 class="text-5xl font-montserrat font-bold text-purple-800 mb-6">Bilan Mobilit√© 360¬∞</h2>
                <p class="text-xl text-gray-600">Rapport technique complet pour accompagnement professionnel</p>
            </div>

            <!-- Contenu bilan -->
            <div class="bg-white rounded-3xl shadow-xl p-10 mb-10 border border-gray-100">
                <div id="report-content">
                    <!-- Contenu du bilan g√©n√©r√© -->
                </div>
            </div>

            <!-- Actions finales -->
            <div class="text-center space-y-6">
                <div class="space-x-6">
                    <button onclick="downloadAdvancedPDF()" class="gradient-bg text-white px-10 py-5 rounded-full text-xl font-montserrat font-bold hover:shadow-xl transition-all">
                        ‚¨áÔ∏è T√©l√©charger bilan PDF
                    </button>
                    <button onclick="shareAdvancedReport()" class="bg-blue-600 text-white px-10 py-5 rounded-full text-xl font-montserrat font-bold hover:bg-blue-700 transition-all">
                        üìß Partager avec conseiller
                    </button>
                    <button onclick="exportData()" class="bg-green-600 text-white px-10 py-5 rounded-full text-xl font-montserrat font-bold hover:bg-green-700 transition-all">
                        üìä Exporter donn√©es
                    </button>
                </div>
                <button onclick="restartDiagnostic()" class="bg-gray-400 text-white px-8 py-4 rounded-full font-bold hover:bg-gray-500 transition-all">
                    üîÑ Nouveau diagnostic
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration compl√®te des domaines et questions
        const diagnosticDomains = [
            {
                id: "geographie",
                title: "Situation g√©ographique & environnement",
                icon: "üó∫Ô∏è",
                color: "blue",
                description: "Analyse de ton environnement et localisation",
                questions: [
                    {
                        id: "lieu_residence",
                        text: "O√π habites-tu pr√©cis√©ment ?",
                        type: "single",
                        options: [
                            { value: "centre_urbain", text: "Centre-ville urbain (+ 100k hab.)", icon: "üèôÔ∏è", score: 5 },
                            { value: "banlieue", text: "Banlieue/p√©riph√©rie urbaine", icon: "üèòÔ∏è", score: 4 },
                            { value: "ville_moyenne", text: "Ville moyenne (10-100k hab.)", icon: "üè¢", score: 3 },
                            { value: "bourg_rural", text: "Bourg rural (< 10k hab.)", icon: "üåæ", score: 2 },
                            { value: "hameau_isole", text: "Hameau/zone isol√©e", icon: "üèîÔ∏è", score: 1 }
                        ]
                    },
                    {
                        id: "distance_services",
                        text: "√Ä quelle distance se trouvent les services essentiels (emploi, formation, sant√©) ?",
                        type: "single",
                        options: [
                            { value: "moins_5km", text: "Moins de 5 km", icon: "üéØ", score: 5 },
                            { value: "5_15km", text: "Entre 5 et 15 km", icon: "üìç", score: 4 },
                            { value: "15_30km", text: "Entre 15 et 30 km", icon: "üó∫Ô∏è", score: 3 },
                            { value: "30_50km", text: "Entre 30 et 50 km", icon: "üõ£Ô∏è", score: 2 },
                            { value: "plus_50km", text: "Plus de 50 km", icon: "üåç", score: 1 }
                        ]
                    },
                    {
                        id: "infrastructures_proximite",
                        text: "Quelles infrastructures de transport sont pr√©sentes pr√®s de chez toi ?",
                        type: "multiple",
                        options: [
                            { value: "arret_bus", text: "Arr√™t de bus", icon: "üöå", score: 2 },
                            { value: "gare_train", text: "Gare ferroviaire", icon: "üöÇ", score: 3 },
                            { value: "metro_tram", text: "M√©tro/Tramway", icon: "üöä", score: 3 },
                            { value: "pistes_cyclables", text: "Pistes cyclables", icon: "üö¥", score: 2 },
                            { value: "parking_gratuit", text: "Parking gratuit", icon: "üÖøÔ∏è", score: 1 },
                            { value: "aucune", text: "Aucune infrastructure", icon: "‚ùå", score: 0 }
                        ]
                    },
                    {
                        id: "qualite_desserte",
                        text: "Comment √©values-tu la qualit√© de la desserte transport dans ta zone ?",
                        type: "scale",
                        scale: { min: 1, max: 5, labels: ["Tr√®s mauvaise", "Mauvaise", "Correcte", "Bonne", "Excellente"] }
                    },
                    {
                        id: "topographie_terrain",
                        text: "Comment est le relief de ta zone de d√©placement ?",
                        type: "single",
                        options: [
                            { value: "plat", text: "Terrain plat", icon: "üèûÔ∏è", score: 5 },
                            { value: "legerement_vallonne", text: "L√©g√®rement vallonn√©", icon: "üåÑ", score: 4 },
                            { value: "vallonne", text: "Vallonn√©", icon: "‚õ∞Ô∏è", score: 3 },
                            { value: "montagneux", text: "Montagneux", icon: "üèîÔ∏è", score: 2 },
                            { value: "tres_accidente", text: "Tr√®s accident√©", icon: "üóª", score: 1 }
                        ]
                    },
                    {
                        id: "securite_zone",
                        text: "Te sens-tu en s√©curit√© pour te d√©placer dans ta zone ?",
                        type: "scale",
                        scale: { min: 1, max: 5, labels: ["Pas du tout", "Peu", "Moyennement", "Assez", "Totalement"] }
                    }
                ]
            },
            {
                id: "transport",
                title: "Transport & moyens mat√©riels",
                icon: "üöó",
                color: "green",
                description: "√âvaluation de tes moyens de transport",
                questions: [
                    {
                        id: "acces_transport_public",
                        text: "Quel est ton niveau d'acc√®s aux transports publics ?",
                        type: "single",
                        options: [
                            { value: "excellent", text: "Excellent (fr√©quent, fiable, proche)", icon: "‚úÖ", score: 5 },
                            { value: "bon", text: "Bon (quelques limitations)", icon: "üëç", score: 4 },
                            { value: "moyen", text: "Moyen (horaires contraignants)", icon: "‚è∞", score: 3 },
                            { value: "limite", text: "Limit√© (peu fr√©quent)", icon: "‚ö†Ô∏è", score: 2 },
                            { value: "inexistant", text: "Inexistant ou inaccessible", icon: "‚ùå", score: 1 }
                        ]
                    },
                    {
                        id: "cout_transport_public",
                        text: "Comment per√ßois-tu le co√ªt des transports publics ?",
                        type: "single",
                        options: [
                            { value: "gratuit", text: "Gratuit ou tr√®s abordable", icon: "üÜì", score: 5 },
                            { value: "abordable", text: "Abordable", icon: "üíö", score: 4 },
                            { value: "correct", text: "Correct", icon: "üíõ", score: 3 },
                            { value: "cher", text: "Cher", icon: "üí∏", score: 2 },
                            { value: "trop_cher", text: "Trop cher pour moi", icon: "üö´", score: 1 }
                        ]
                    },
                    {
                        id: "permis_conduire",
                        text: "Quelle est ta situation concernant le permis de conduire ?",
                        type: "single",
                        options: [
                            { value: "obtenu", text: "J'ai mon permis", icon: "üöó", score: 5 },
                            { value: "en_cours", text: "En cours de passage", icon: "üìö", score: 3 },
                            { value: "inscrit", text: "Inscrit en auto-√©cole", icon: "üè´", score: 2 },
                            { value: "projet", text: "Projet de le passer", icon: "üí≠", score: 1 },
                            { value: "pas_prevu", text: "Pas pr√©vu", icon: "üö´", score: 0 }
                        ]
                    },
                    {
                        id: "vehicule_personnel",
                        text: "De quels v√©hicules personnels disposes-tu ?",
                        type: "multiple",
                        options: [
                            { value: "voiture", text: "Voiture personnelle", icon: "üöó", score: 5 },
                            { value: "scooter_moto", text: "Scooter/Moto", icon: "üõµ", score: 4 },
                            { value: "velo_electrique", text: "V√©lo √©lectrique", icon: "üö¥‚Äç‚ôÇÔ∏è", score: 3 },
                            { value: "velo_classique", text: "V√©lo classique", icon: "üö≤", score: 2 },
                            { value: "trottinette", text: "Trottinette √©lectrique", icon: "üõ¥", score: 1 },
                            { value: "aucun", text: "Aucun v√©hicule", icon: "üö∂", score: 0 }
                        ]
                    },
                    {
                        id: "acces_vehicule_famille",
                        text: "Peux-tu utiliser un v√©hicule familial ?",
                        type: "single",
                        options: [
                            { value: "libre_acces", text: "Libre acc√®s quand je veux", icon: "üîì", score: 5 },
                            { value: "souvent", text: "Souvent disponible", icon: "‚úÖ", score: 4 },
                            { value: "parfois", text: "Parfois disponible", icon: "‚è∞", score: 3 },
                            { value: "rarement", text: "Rarement disponible", icon: "‚ö†Ô∏è", score: 2 },
                            { value: "jamais", text: "Jamais disponible", icon: "‚ùå", score: 1 }
                        ]
                    },
                    {
                        id: "etat_vehicules",
                        text: "Dans quel √©tat sont tes moyens de transport ?",
                        type: "single",
                        options: [
                            { value: "excellent", text: "Excellent √©tat, fiables", icon: "‚≠ê", score: 5 },
                            { value: "bon", text: "Bon √©tat g√©n√©ral", icon: "üëç", score: 4 },
                            { value: "correct", text: "√âtat correct", icon: "üîß", score: 3 },
                            { value: "problematique", text: "Probl√®mes fr√©quents", icon: "‚ö†Ô∏è", score: 2 },
                            { value: "mauvais", text: "Mauvais √©tat", icon: "üî¥", score: 1 }
                        ]
                    }
                ]
            },
            {
                id: "competences",
                title: "Connaissances & comp√©tences mobilit√©",
                icon: "üß†",
                color: "purple",
                description: "√âvaluation de tes savoir-faire en mobilit√©",
                questions: [
                    {
                        id: "lecture_horaires",
                        text: "√Ä quel point ma√Ætrises-tu la lecture d'horaires et de plans de transport ?",
                        type: "scale",
                        scale: { min: 1, max: 5, labels: ["Pas du tout", "Difficilement", "Moyennement", "Bien", "Parfaitement"] }
                    },
                    {
                        id: "planification_trajet",
                        text: "Sais-tu planifier un trajet complexe avec plusieurs correspondances ?",
                        type: "single",
                        options: [
                            { value: "expert", text: "Oui, je suis expert", icon: "üéØ", score: 5 },
                            { value: "autonome", text: "Oui, de fa√ßon autonome", icon: "‚úÖ", score: 4 },
                            { value: "avec_aide", text: "Avec un peu d'aide", icon: "ü§ù", score: 3 },
                            { value: "difficilement", text: "Difficilement", icon: "üò∞", score: 2 },
                            { value: "pas_du_tout", text: "Pas du tout", icon: "‚ùå", score: 1 }
                        ]
                    },
                    {
                        id: "apps_mobilite",
                        text: "Quelles applications de mobilit√© utilises-tu r√©guli√®rement ?",
                        type: "multiple",
                        options: [
                            { value: "google_maps", text: "Google Maps", icon: "üó∫Ô∏è", score: 2 },
                            { value: "citymapper", text: "Citymapper", icon: "üöá", score: 2 },
                            { value: "sncf_connect", text: "SNCF Connect", icon: "üöÇ", score: 2 },
                            { value: "apps_locales", text: "Apps transport locales", icon: "üì±", score: 2 },
                            { value: "covoiturage", text: "Apps covoiturage", icon: "üöó", score: 1 },
                            { value: "aucune", text: "Aucune application", icon: "üö´", score: 0 }
                        ]
                    },
                    {
                        id: "connaissance_aides",
                        text: "Connais-tu les aides financi√®res √† la mobilit√© ?",
                        type: "single",
                        options: [
                            { value: "tres_bien", text: "Tr√®s bien, j'en utilise", icon: "üí°", score: 5 },
                            { value: "bien", text: "Bien, je sais o√π chercher", icon: "üîç", score: 4 },
                            { value: "vaguement", text: "Vaguement", icon: "ü§î", score: 3 },
                            { value: "peu", text: "Tr√®s peu", icon: "‚ùì", score: 2 },
                            { value: "pas_du_tout", text: "Pas du tout", icon: "‚ùå", score: 1 }
                        ]
                    },
                    {
                        id: "adaptation_imprevus",
                        text: "Comment r√©agis-tu face aux impr√©vus de transport (retards, gr√®ves, pannes) ?",
                        type: "single",
                        options: [
                            { value: "tres_bien", text: "Je trouve toujours une solution", icon: "üéØ", score: 5 },
                            { value: "bien", text: "Je m'adapte bien", icon: "üí™", score: 4 },
                            { value: "moyen", text: "√áa d√©pend de la situation", icon: "ü§∑", score: 3 },
                            { value: "difficilement", text: "J'ai du mal √† m'adapter", icon: "üò∞", score: 2 },
                            { value: "panique", text: "Je panique facilement", icon: "üò±", score: 1 }
                        ]
                    },
                    {
                        id: "conduite_autonome",
                        text: "Si tu conduis, comment √©values-tu ton niveau ?",
                        type: "single",
                        conditional: { question: "permis_conduire", values: ["obtenu"] },
                        options: [
                            { value: "expert", text: "Conducteur expert", icon: "üèÜ", score: 5 },
                            { value: "confirme", text: "Conducteur confirm√©", icon: "‚úÖ", score: 4 },
                            { value: "correct", text: "Niveau correct", icon: "üëç", score: 3 },
                            { value: "debutant", text: "Encore d√©butant", icon: "üî∞", score: 2 },
                            { value: "non_applicable", text: "Je ne conduis pas", icon: "üö´", score: 0 }
                        ]
                    }
                ]
            },
            {
                id: "sante",
                title: "Sant√©, condition physique & psychologie",
                icon: "üíö",
                color: "red",
                description: "Impact de ta sant√© sur ta mobilit√©",
                questions: [
                    {
                        id: "condition_physique",
                        text: "Comment √©values-tu ta condition physique pour les d√©placements ?",
                        type: "scale",
                        scale: { min: 1, max: 5, labels: ["Tr√®s limit√©e", "Limit√©e", "Correcte", "Bonne", "Excellente"] }
                    },
                    {
                        id: "capacite_marche",
                        text: "Quelle distance peux-tu parcourir √† pied confortablement ?",
                        type: "single",
                        options: [
                            { value: "plus_5km", text: "Plus de 5 km", icon: "üö∂‚Äç‚ôÇÔ∏è", score: 5 },
                            { value: "2_5km", text: "Entre 2 et 5 km", icon: "üëü", score: 4 },
                            { value: "1_2km", text: "Entre 1 et 2 km", icon: "üö∂", score: 3 },
                            { value: "500m_1km", text: "Entre 500m et 1 km", icon: "ü¶Ω", score: 2 },
                            { value: "moins_500m", text: "Moins de 500m", icon: "‚ôø", score: 1 }
                        ]
                    },
                    {
                        id: "capacite_velo",
                        text: "Peux-tu utiliser un v√©lo ?",
                        type: "single",
                        options: [
                            { value: "longue_distance", text: "Oui, m√™me longue distance", icon: "üö¥‚Äç‚ôÇÔ∏è", score: 5 },
                            { value: "courte_distance", text: "Oui, courte distance", icon: "üö≤", score: 4 },
                            { value: "avec_assistance", text: "Avec assistance √©lectrique", icon: "‚ö°", score: 3 },
                            { value: "difficilement", text: "Difficilement", icon: "üòì", score: 2 },
                            { value: "impossible", text: "Impossible", icon: "‚ùå", score: 1 }
                        ]
                    },
                    {
                        id: "fatigue_trajets",
                        text: "Les trajets te g√©n√®rent-ils de la fatigue ?",
                        type: "single",
                        options: [
                            { value: "jamais", text: "Jamais", icon: "üòä", score: 5 },
                            { value: "rarement", text: "Rarement", icon: "üôÇ", score: 4 },
                            { value: "parfois", text: "Parfois", icon: "üòê", score: 3 },
                            { value: "souvent", text: "Souvent", icon: "üò¥", score: 2 },
                            { value: "toujours", text: "Toujours", icon: "üòµ", score: 1 }
                        ]
                    },
                    {
                        id: "stress_mobilite",
                        text: "Ressens-tu du stress ou de l'anxi√©t√© li√©s aux d√©placements ?",
                        type: "multiple",
                        options: [
                            { value: "conduite", text: "Stress de conduite", icon: "üöó", score: -1 },
                            { value: "transports_publics", text: "Anxi√©t√© en transport public", icon: "üöå", score: -1 },
                            { value: "retards", text: "Stress des retards", icon: "‚è∞", score: -1 },
                            { value: "foule", text: "Peur de la foule", icon: "üë•", score: -1 },
                            { value: "nuit", text: "Peur des d√©placements nocturnes", icon: "üåô", score: -1 },
                            { value: "aucun", text: "Aucun stress particulier", icon: "üòå", score: 3 }
                        ]
                    },
                    {
                        id: "handicap_mobilite",
                        text: "As-tu un handicap ou une limitation qui affecte ta mobilit√© ?",
                        type: "single",
                        options: [
                            { value: "aucun", text: "Aucun handicap", icon: "‚úÖ", score: 5 },
                            { value: "leger", text: "Limitation l√©g√®re", icon: "‚ö†Ô∏è", score: 4 },
                            { value: "modere", text: "Limitation mod√©r√©e", icon: "ü¶Ω", score: 3 },
                            { value: "important", text: "Handicap important", icon: "‚ôø", score: 2 },
                            { value: "severe", text: "Handicap s√©v√®re", icon: "üè•", score: 1 }
                        ]
                    }
                ]
            },
            {
                id: "financement",
                title: "Financement & moyens √©conomiques",
                icon: "üí∞",
                color: "yellow",
                description: "Analyse de tes ressources financi√®res pour la mobilit√©",
                questions: [
                    {
                        id: "budget_transport_mensuel",
                        text: "Quel est ton budget mensuel pour les transports ?",
                        type: "single",
                        options: [
                            { value: "plus_200", text: "Plus de 200‚Ç¨", icon: "üí∏", score: 5 },
                            { value: "100_200", text: "Entre 100 et 200‚Ç¨", icon: "üíµ", score: 4 },
                            { value: "50_100", text: "Entre 50 et 100‚Ç¨", icon: "üí¥", score: 3 },
                            { value: "20_50", text: "Entre 20 et 50‚Ç¨", icon: "üí∂", score: 2 },
                            { value: "moins_20", text: "Moins de 20‚Ç¨", icon: "ü™ô", score: 1 }
                        ]
                    },
                    {
                        id: "impact_budget",
                        text: "Quel impact les frais de transport ont-ils sur ton budget ?",
                        type: "single",
                        options: [
                            { value: "aucun", text: "Aucun impact", icon: "üòä", score: 5 },
                            { value: "leger", text: "Impact l√©ger", icon: "üôÇ", score: 4 },
                            { value: "modere", text: "Impact mod√©r√©", icon: "üòê", score: 3 },
                            { value: "important", text: "Impact important", icon: "üòü", score: 2 },
                            { value: "critique", text: "Impact critique", icon: "üò∞", score: 1 }
                        ]
                    },
                    {
                        id: "aides_financieres",
                        text: "B√©n√©ficies-tu d'aides financi√®res pour la mobilit√© ?",
                        type: "multiple",
                        options: [
                            { value: "tarif_reduit", text: "Tarifs r√©duits transport", icon: "üé´", score: 2 },
                            { value: "aide_permis", text: "Aide au permis", icon: "üöó", score: 3 },
                            { value: "aide_vehicule", text: "Aide √† l'achat v√©hicule", icon: "üí∞", score: 3 },
                            { value: "carte_transport", text: "Carte transport gratuite", icon: "üÜì", score: 2 },
                            { value: "remboursement_employeur", text: "Remboursement employeur", icon: "üè¢", score: 2 },
                            { value: "aucune", text: "Aucune aide", icon: "‚ùå", score: 0 }
                        ]
                    },
                    {
                        id: "capacite_financement",
                        text: "Pourrais-tu financer un projet mobilit√© (permis, v√©hicule) ?",
                        type: "single",
                        options: [
                            { value: "facilement", text: "Facilement", icon: "üí≥", score: 5 },
                            { value: "avec_effort", text: "Avec un effort d'√©pargne", icon: "üè¶", score: 4 },
                            { value: "avec_aide", text: "Avec aide familiale", icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", score: 3 },
                            { value: "difficilement", text: "Tr√®s difficilement", icon: "üò∞", score: 2 },
                            { value: "impossible", text: "Impossible actuellement", icon: "üö´", score: 1 }
                        ]
                    },
                    {
                        id: "cout_entretien",
                        text: "Comment g√®res-tu les co√ªts d'entretien de tes moyens de transport ?",
                        type: "single",
                        options: [
                            { value: "sans_probleme", text: "Sans probl√®me", icon: "üîß", score: 5 },
                            { value: "planifie", text: "Je planifie les d√©penses", icon: "üìÖ", score: 4 },
                            { value: "au_cas_par_cas", text: "Au cas par cas", icon: "ü§∑", score: 3 },
                            { value: "difficilement", text: "Difficilement", icon: "üòì", score: 2 },
                            { value: "impossible", text: "Je ne peux pas", icon: "‚ùå", score: 1 }
                        ]
                    },
                    {
                        id: "priorite_depenses",
                        text: "Quelle priorit√© accordes-tu aux d√©penses de mobilit√© ?",
                        type: "single",
                        options: [
                            { value: "priorite_absolue", text: "Priorit√© absolue", icon: "üéØ", score: 5 },
                            { value: "tres_importante", text: "Tr√®s importante", icon: "‚≠ê", score: 4 },
                            { value: "importante", text: "Importante", icon: "üëç", score: 3 },
                            { value: "secondaire", text: "Secondaire", icon: "‚è≥", score: 2 },
                            { value: "negligeable", text: "N√©gligeable", icon: "ü§è", score: 1 }
                        ]
                    }
                ]
            },
            {
                id: "social",
                title: "Social & ressources relationnelles",
                icon: "üë•",
                color: "pink",
                description: "√âvaluation de ton r√©seau social pour la mobilit√©",
                questions: [
                    {
                        id: "soutien_famille",
                        text: "Ta famille peut-elle t'aider pour tes d√©placements ?",
                        type: "single",
                        options: [
                            { value: "toujours", text: "Toujours disponible", icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", score: 5 },
                            { value: "souvent", text: "Souvent disponible", icon: "‚úÖ", score: 4 },
                            { value: "parfois", text: "Parfois disponible", icon: "‚è∞", score: 3 },
                            { value: "rarement", text: "Rarement disponible", icon: "‚ö†Ô∏è", score: 2 },
                            { value: "jamais", text: "Jamais disponible", icon: "‚ùå", score: 1 }
                        ]
                    },
                    {
                        id: "reseau_amis",
                        text: "Tes amis peuvent-ils t'aider pour la mobilit√© ?",
                        type: "single",
                        options: [
                            { value: "tres_souvent", text: "Tr√®s souvent", icon: "üë´", score: 5 },
                            { value: "souvent", text: "Souvent", icon: "ü§ù", score: 4 },
                            { value: "parfois", text: "Parfois", icon: "üëã", score: 3 },
                            { value: "rarement", text: "Rarement", icon: "üòï", score: 2 },
                            { value: "jamais", text: "Jamais", icon: "üòû", score: 1 }
                        ]
                    },
                    {
                        id: "covoiturage_pratique",
                        text: "Pratiques-tu le covoiturage ?",
                        type: "single",
                        options: [
                            { value: "regulierement", text: "R√©guli√®rement", icon: "üöó", score: 5 },
                            { value: "occasionnellement", text: "Occasionnellement", icon: "ü§ù", score: 4 },
                            { value: "rarement", text: "Rarement", icon: "‚è∞", score: 3 },
                            { value: "jamais_interesse", text: "Jamais mais int√©ress√©(e)", icon: "ü§î", score: 2 },
                            { value: "jamais_pas_interesse", text: "Jamais et pas int√©ress√©(e)", icon: "üö´", score: 1 }
                        ]
                    },
                    {
                        id: "isolement_mobilite",
                        text: "Te sens-tu isol√©(e) √† cause de probl√®mes de mobilit√© ?",
                        type: "single",
                        options: [
                            { value: "jamais", text: "Jamais", icon: "üòä", score: 5 },
                            { value: "rarement", text: "Rarement", icon: "üôÇ", score: 4 },
                            { value: "parfois", text: "Parfois", icon: "üòê", score: 3 },
                            { value: "souvent", text: "Souvent", icon: "üòî", score: 2 },
                            { value: "toujours", text: "Toujours", icon: "üòû", score: 1 }
                        ]
                    },
                    {
                        id: "participation_sociale",
                        text: "La mobilit√© limite-t-elle ta participation √† des activit√©s sociales ?",
                        type: "single",
                        options: [
                            { value: "jamais", text: "Jamais", icon: "üéâ", score: 5 },
                            { value: "rarement", text: "Rarement", icon: "üéä", score: 4 },
                            { value: "parfois", text: "Parfois", icon: "üòê", score: 3 },
                            { value: "souvent", text: "Souvent", icon: "üòï", score: 2 },
                            { value: "toujours", text: "Toujours", icon: "üòû", score: 1 }
                        ]
                    },
                    {
                        id: "entraide_communaute",
                        text: "Existe-t-il des syst√®mes d'entraide transport dans ta communaut√© ?",
                        type: "multiple",
                        options: [
                            { value: "transport_solidaire", text: "Transport solidaire", icon: "ü§ù", score: 2 },
                            { value: "covoiturage_local", text: "Covoiturage local organis√©", icon: "üöó", score: 2 },
                            { value: "velo_partage", text: "V√©los en libre-service", icon: "üö≤", score: 1 },
                            { value: "accompagnement", text: "Service d'accompagnement", icon: "üë•", score: 2 },
                            { value: "aucun", text: "Aucun syst√®me", icon: "‚ùå", score: 0 }
                        ]
                    }
                ]
            },
            {
                id: "contraintes",
                title: "Contraintes externes & barri√®res",
                icon: "‚ö†Ô∏è",
                color: "orange",
                description: "Identification des obstacles √† ta mobilit√©",
                questions: [
                    {
                        id: "contraintes_horaires",
                        text: "Les horaires de transport correspondent-ils √† tes besoins ?",
                        type: "single",
                        options: [
                            { value: "parfaitement", text: "Parfaitement adapt√©s", icon: "‚è∞", score: 5 },
                            { value: "bien", text: "Bien adapt√©s", icon: "‚úÖ", score: 4 },
                            { value: "moyennement", text: "Moyennement adapt√©s", icon: "‚ö†Ô∏è", score: 3 },
                            { value: "mal", text: "Mal adapt√©s", icon: "üòï", score: 2 },
                            { value: "pas_du_tout", text: "Pas du tout adapt√©s", icon: "‚ùå", score: 1 }
                        ]
                    },
                    {
                        id: "impact_meteo",
                        text: "La m√©t√©o affecte-t-elle tes d√©placements ?",
                        type: "single",
                        options: [
                            { value: "jamais", text: "Jamais", icon: "‚òÄÔ∏è", score: 5 },
                            { value: "peu", text: "Tr√®s peu", icon: "üå§Ô∏è", score: 4 },
                            { value: "moderement", text: "Mod√©r√©ment", icon: "üå¶Ô∏è", score: 3 },
                            { value: "beaucoup", text: "Beaucoup", icon: "üåßÔ∏è", score: 2 },
                            { value: "enormement", text: "√ânorm√©ment", icon: "‚ùÑÔ∏è", score: 1 }
                        ]
                    },
                    {
                        id: "securite_trajets",
                        text: "Te sens-tu en s√©curit√© lors de tes trajets ?",
                        type: "scale",
                        scale: { min: 1, max: 5, labels: ["Pas du tout", "Peu", "Moyennement", "Assez", "Totalement"] }
                    },
                    {
                        id: "barriere_administrative",
                        text: "Rencontres-tu des barri√®res administratives pour la mobilit√© ?",
                        type: "multiple",
                        options: [
                            { value: "procedures_complexes", text: "Proc√©dures trop complexes", icon: "üìã", score: -1 },
                            { value: "documents_manquants", text: "Documents manquants", icon: "üìÑ", score: -1 },
                            { value: "delais_longs", text: "D√©lais trop longs", icon: "‚è≥", score: -1 },
                            { value: "couts_cach√©s", text: "Co√ªts cach√©s", icon: "üí∏", score: -1 },
                            { value: "aucune", text: "Aucune barri√®re", icon: "‚úÖ", score: 2 }
                        ]
                    },
                    {
                        id: "accessibilite_physique",
                        text: "L'accessibilit√© physique des transports est-elle adapt√©e ?",
                        type: "single",
                        options: [
                            { value: "parfaite", text: "Parfaitement adapt√©e", icon: "‚ôø", score: 5 },
                            { value: "bonne", text: "Bonne accessibilit√©", icon: "‚úÖ", score: 4 },
                            { value: "correcte", text: "Accessibilit√© correcte", icon: "üëç", score: 3 },
                            { value: "limitee", text: "Accessibilit√© limit√©e", icon: "‚ö†Ô∏è", score: 2 },
                            { value: "mauvaise", text: "Mauvaise accessibilit√©", icon: "‚ùå", score: 1 }
                        ]
                    },
                    {
                        id: "contraintes_familiales",
                        text: "As-tu des contraintes familiales qui limitent ta mobilit√© ?",
                        type: "multiple",
                        options: [
                            { value: "garde_enfants", text: "Garde d'enfants", icon: "üë∂", score: -1 },
                            { value: "aide_personne_agee", text: "Aide √† personne √¢g√©e", icon: "üë¥", score: -1 },
                            { value: "horaires_famille", text: "Horaires familiaux contraignants", icon: "‚è∞", score: -1 },
                            { value: "interdiction_famille", text: "Interdiction familiale", icon: "üö´", score: -2 },
                            { value: "aucune", text: "Aucune contrainte", icon: "‚úÖ", score: 2 }
                        ]
                    }
                ]
            },
            {
                id: "projets",
                title: "Projets personnels & aspirations mobilit√©",
                icon: "üéØ",
                color: "indigo",
                description: "Tes objectifs et projets de mobilit√©",
                questions: [
                    {
                        id: "objectif_principal",
                        text: "Quel est ton objectif principal en mati√®re de mobilit√© ?",
                        type: "single",
                        options: [
                            { value: "emploi", text: "Acc√©der √† l'emploi", icon: "üíº", score: 5 },
                            { value: "formation", text: "Suivre une formation", icon: "üìö", score: 4 },
                            { value: "autonomie", text: "Gagner en autonomie", icon: "ü¶Ö", score: 4 },
                            { value: "social", text: "D√©velopper ma vie sociale", icon: "üë•", score: 3 },
                            { value: "loisirs", text: "Acc√©der aux loisirs", icon: "üé≠", score: 3 }
                        ]
                    },
                    {
                        id: "projet_court_terme",
                        text: "Quel est ton projet mobilit√© √† court terme (6 mois) ?",
                        type: "single",
                        options: [
                            { value: "permis", text: "Passer le permis", icon: "üöó", score: 4 },
                            { value: "vehicule", text: "Acqu√©rir un v√©hicule", icon: "üõí", score: 4 },
                            { value: "ameliorer_transport", text: "Am√©liorer mes transports actuels", icon: "‚¨ÜÔ∏è", score: 3 },
                            { value: "competences", text: "D√©velopper mes comp√©tences mobilit√©", icon: "üìà", score: 3 },
                            { value: "aucun", text: "Aucun projet particulier", icon: "ü§∑", score: 1 }
                        ]
                    },
                    {
                        id: "projet_long_terme",
                        text: "Quel est ton projet mobilit√© √† long terme (2-5 ans) ?",
                        type: "single",
                        options: [
                            { value: "autonomie_complete", text: "Autonomie compl√®te", icon: "üåü", score: 5 },
                            { value: "mobilite_professionnelle", text: "Mobilit√© professionnelle", icon: "üíº", score: 4 },
                            { value: "mobilite_internationale", text: "Mobilit√© internationale", icon: "‚úàÔ∏è", score: 4 },
                            { value: "mobilite_durable", text: "Mobilit√© durable/√©cologique", icon: "üå±", score: 3 },
                            { value: "pas_de_projet", text: "Pas de projet d√©fini", icon: "‚ùì", score: 1 }
                        ]
                    },
                    {
                        id: "motivation_changement",
                        text: "Quelle est ta motivation pour am√©liorer ta mobilit√© ?",
                        type: "scale",
                        scale: { min: 1, max: 5, labels: ["Tr√®s faible", "Faible", "Moyenne", "Forte", "Tr√®s forte"] }
                    },
                    {
                        id: "solutions_alternatives",
                        text: "Es-tu ouvert(e) √† des solutions de mobilit√© alternatives ?",
                        type: "multiple",
                        options: [
                            { value: "velo_electrique", text: "V√©lo √©lectrique", icon: "üö¥‚Äç‚ôÇÔ∏è", score: 2 },
                            { value: "covoiturage", text: "Covoiturage r√©gulier", icon: "üöó", score: 2 },
                            { value: "transport_demande", text: "Transport √† la demande", icon: "üìû", score: 2 },
                            { value: "mobilite_partagee", text: "Mobilit√© partag√©e", icon: "ü§ù", score: 2 },
                            { value: "teletravail", text: "T√©l√©travail/formation √† distance", icon: "üíª", score: 1 },
                            { value: "aucune", text: "Aucune alternative", icon: "üö´", score: 0 }
                        ]
                    },
                    {
                        id: "priorite_mobilite",
                        text: "Quelle est ta priorit√© en mati√®re de mobilit√© ?",
                        type: "single",
                        options: [
                            { value: "rapidite", text: "Rapidit√© des trajets", icon: "‚ö°", score: 3 },
                            { value: "economie", text: "√âconomie/co√ªt r√©duit", icon: "üí∞", score: 3 },
                            { value: "confort", text: "Confort de transport", icon: "üõãÔ∏è", score: 2 },
                            { value: "ecologie", text: "Respect de l'environnement", icon: "üå±", score: 2 },
                            { value: "flexibilite", text: "Flexibilit√© horaire", icon: "‚è∞", score: 3 }
                        ]
                    }
                ]
            }
        ];

        // Variables globales
        let currentDomainIndex = 0;
        let currentQuestionInDomain = 0;
        let totalQuestions = 0;
        let currentQuestionIndex = 0;
        let answers = {};
        let domainScores = {};
        let currentProfile = "";

        // Calcul du nombre total de questions
        diagnosticDomains.forEach(domain => {
            totalQuestions += domain.questions.length;
        });

        function startDiagnostic() {
            document.getElementById('welcome-page').classList.add('hidden');
            document.getElementById('question-pages').classList.remove('hidden');
            initializeStepIndicators();
            showCurrentQuestion();
        }

        function initializeStepIndicators() {
            // Fonction vide - indicateurs supprim√©s
        }

        function updateStepIndicators() {
            // Fonction vide - indicateurs supprim√©s
        }

        function showCurrentQuestion() {
            const domain = diagnosticDomains[currentDomainIndex];
            const question = domain.questions[currentQuestionInDomain];
            const container = document.getElementById('question-container');
            
            // V√©rifier les conditions
            if (question.conditional && !checkConditional(question.conditional)) {
                nextQuestion();
                return;
            }
            
            updateProgress();
            updateStepIndicators();
            
            let html = `
                <div class="mb-10">
                    <div class="flex items-center mb-8">
                        <div class="w-20 h-20 bg-${domain.color}-100 rounded-full flex items-center justify-center mr-6 shadow-lg">
                            <span class="text-4xl">${domain.icon}</span>
                        </div>
                        <div>
                            <h3 class="text-3xl font-montserrat font-bold text-purple-800">${domain.title}</h3>
                            <p class="text-lg text-gray-600 mt-2">${domain.description}</p>
                            <p class="text-sm text-${domain.color}-600 font-semibold mt-1">Question ${currentQuestionInDomain + 1} sur ${domain.questions.length}</p>
                        </div>
                    </div>
                </div>

                <div class="mb-10">
                    <h4 class="text-2xl font-nunito font-bold text-pink-600 mb-8">${question.text}</h4>
            `;

            if (question.type === 'scale') {
                html += generateScaleQuestion(question);
            } else {
                html += generateOptionsQuestion(question);
            }

            html += `</div>`;
            container.innerHTML = html;
            
            updateNavigation();
        }

        function generateScaleQuestion(question) {
            const scale = question.scale;
            let html = '<div class="flex justify-center items-center space-x-4 mb-6">';
            
            for (let i = scale.min; i <= scale.max; i++) {
                const isSelected = answers[question.id] === i;
                html += `
                    <div class="text-center">
                        <button onclick="selectScaleOption('${question.id}', ${i}, this)" 
                                class="scale-option w-16 h-16 rounded-full border-4 font-bold text-lg transition-all ${
                                    isSelected ? 'bg-purple-600 text-white border-purple-600 transform scale-110' : 'bg-white border-gray-300 hover:border-purple-400'
                                }">
                            ${i}
                        </button>
                        <p class="text-xs text-gray-600 mt-2 max-w-16">${scale.labels[i-1]}</p>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        function generateOptionsQuestion(question) {
            let html = '<div class="grid gap-4">';
            
            question.options.forEach((option, index) => {
                const isSelected = question.type === 'multiple' 
                    ? (answers[question.id] && answers[question.id].includes(option.value))
                    : (answers[question.id] === option.value);
                
                html += `
                    <div class="option-card bg-gray-50 border-3 border-gray-200 rounded-2xl p-6 card-hover ${isSelected ? 'option-selected border-purple-600' : ''}" 
                         onclick="selectOption('${question.id}', '${option.value}', '${question.type}', this)">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="text-3xl mr-6">${option.icon}</span>
                                <span class="font-nunito font-semibold text-lg">${option.text}</span>
                            </div>
                            ${question.type === 'multiple' ? '<span class="text-3xl">‚òê</span>' : ''}
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            return html;
        }

        function checkConditional(conditional) {
            const answer = answers[conditional.question];
            return conditional.values.includes(answer);
        }

        function selectOption(questionId, value, type, element) {
            if (type === 'multiple') {
                if (!answers[questionId]) answers[questionId] = [];
                
                const index = answers[questionId].indexOf(value);
                if (index > -1) {
                    answers[questionId].splice(index, 1);
                    element.classList.remove('option-selected', 'border-purple-600');
                    element.querySelector('span:last-child').textContent = '‚òê';
                } else {
                    answers[questionId].push(value);
                    element.classList.add('option-selected', 'border-purple-600');
                    element.querySelector('span:last-child').textContent = '‚òë';
                }
            } else {
                answers[questionId] = value;
                
                document.querySelectorAll('.option-card').forEach(card => {
                    card.classList.remove('option-selected', 'border-purple-600');
                });
                
                element.classList.add('option-selected', 'border-purple-600');
            }
        }

        function selectScaleOption(questionId, value, element) {
            answers[questionId] = value;
            
            document.querySelectorAll('.scale-option').forEach(btn => {
                btn.classList.remove('bg-purple-600', 'text-white', 'border-purple-600', 'transform', 'scale-110');
                btn.classList.add('bg-white', 'border-gray-300');
            });
            
            element.classList.remove('bg-white', 'border-gray-300');
            element.classList.add('bg-purple-600', 'text-white', 'border-purple-600', 'transform', 'scale-110');
        }

        function nextQuestion() {
            const domain = diagnosticDomains[currentDomainIndex];
            
            if (currentQuestionInDomain < domain.questions.length - 1) {
                currentQuestionInDomain++;
            } else if (currentDomainIndex < diagnosticDomains.length - 1) {
                currentDomainIndex++;
                currentQuestionInDomain = 0;
            } else {
                // Fin du questionnaire
                calculateScores();
                generateProfile();
                showProfile();
                return;
            }
            
            currentQuestionIndex++;
            showCurrentQuestion();
        }

        function previousQuestion() {
            if (currentQuestionInDomain > 0) {
                currentQuestionInDomain--;
            } else if (currentDomainIndex > 0) {
                currentDomainIndex--;
                currentQuestionInDomain = diagnosticDomains[currentDomainIndex].questions.length - 1;
            }
            
            currentQuestionIndex--;
            showCurrentQuestion();
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `Question ${currentQuestionIndex + 1}/${totalQuestions}`;
            document.getElementById('step-indicator').textContent = `√âtape ${currentDomainIndex + 1}/8`;
            document.getElementById('question-counter').textContent = `${currentQuestionIndex + 1} sur ${totalQuestions}`;
            document.getElementById('remaining-questions').textContent = totalQuestions - currentQuestionIndex - 1;
            document.getElementById('domain-title').textContent = diagnosticDomains[currentDomainIndex].title;
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            prevBtn.disabled = currentDomainIndex === 0 && currentQuestionInDomain === 0;
            
            if (currentDomainIndex === diagnosticDomains.length - 1 && currentQuestionInDomain === diagnosticDomains[currentDomainIndex].questions.length - 1) {
                nextBtn.textContent = 'Voir mon profil 360¬∞ üéØ';
            } else {
                nextBtn.textContent = 'Suivant ‚û°Ô∏è';
            }
        }

        function calculateScores() {
            // Initialisation des scores par domaine
            diagnosticDomains.forEach(domain => {
                domainScores[domain.id] = 0;
            });

            // Calcul des scores
            diagnosticDomains.forEach(domain => {
                let domainScore = 0;
                let questionCount = 0;

                domain.questions.forEach(question => {
                    const answer = answers[question.id];
                    if (answer !== undefined) {
                        questionCount++;
                        
                        if (question.type === 'scale') {
                            domainScore += (answer / 5) * 100; // Normalisation sur 100
                        } else if (question.type === 'multiple') {
                            if (Array.isArray(answer)) {
                                answer.forEach(val => {
                                    const option = question.options.find(opt => opt.value === val);
                                    if (option && option.score) {
                                        domainScore += option.score * 10; // Multiplication pour normaliser
                                    }
                                });
                            }
                        } else {
                            const option = question.options.find(opt => opt.value === answer);
                            if (option && option.score !== undefined) {
                                domainScore += (option.score / 5) * 100; // Normalisation sur 100
                            }
                        }
                    }
                });

                if (questionCount > 0) {
                    domainScores[domain.id] = Math.max(0, Math.min(100, domainScore / questionCount));
                }
            });
        }

        function generateProfile() {
            // Calcul du score global
            const totalScore = Object.values(domainScores).reduce((sum, score) => sum + score, 0) / Object.keys(domainScores).length;
            
            // D√©termination du profil bas√© sur les scores
            if (totalScore >= 80) {
                currentProfile = "üåü Mobilit√© Autonome Avanc√©e";
            } else if (totalScore >= 65) {
                currentProfile = "üöÄ Mobilit√© en D√©veloppement";
            } else if (totalScore >= 50) {
                currentProfile = "üîÑ Mobilit√© en Transition";
            } else if (totalScore >= 35) {
                currentProfile = "üå± Mobilit√© √âmergente";
            } else {
                currentProfile = "üéØ Mobilit√© √† Construire";
            }
        }

        function showProfile() {
            document.getElementById('question-pages').classList.add('hidden');
            document.getElementById('profile-page').classList.remove('hidden');
            
            document.getElementById('profile-badge').textContent = currentProfile;
            
            generateRadarChart();
            generateDomainScores();
            generateAdvancedRecommendations();
        }

        function generateRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            const labels = diagnosticDomains.map(domain => domain.title.split(' ')[0]);
            const data = diagnosticDomains.map(domain => domainScores[domain.id] || 0);
            
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ton profil mobilit√©',
                        data: data,
                        backgroundColor: 'rgba(122, 26, 122, 0.2)',
                        borderColor: '#7A1A7A',
                        borderWidth: 3,
                        pointBackgroundColor: '#E61D72',
                        pointBorderColor: '#7A1A7A',
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                font: { size: 12 }
                            },
                            grid: { color: '#e5e7eb' },
                            angleLines: { color: '#d1d5db' }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function generateDomainScores() {
            const container = document.getElementById('domain-scores');
            let html = '';
            
            diagnosticDomains.forEach(domain => {
                const score = Math.round(domainScores[domain.id] || 0);
                let colorClass = 'red';
                if (score >= 70) colorClass = 'green';
                else if (score >= 50) colorClass = 'yellow';
                else if (score >= 30) colorClass = 'orange';
                
                html += `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                        <div class="flex items-center">
                            <span class="text-2xl mr-4">${domain.icon}</span>
                            <div>
                                <h4 class="font-semibold text-gray-800">${domain.title}</h4>
                                <p class="text-sm text-gray-600">${domain.description}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-${colorClass}-600">${score}%</div>
                            <div class="w-24 h-3 bg-gray-200 rounded-full">
                                <div class="h-3 bg-${colorClass}-500 rounded-full transition-all duration-1000" style="width: ${score}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function generateAdvancedRecommendations() {
            const container = document.getElementById('recommendations-grid');
            let recommendations = [];

            // Recommandations bas√©es sur les scores faibles
            diagnosticDomains.forEach(domain => {
                const score = domainScores[domain.id] || 0;
                if (score < 50) {
                    recommendations.push({
                        title: `Am√©liorer ${domain.title.split(' ')[0]}`,
                        description: getRecommendationForDomain(domain.id),
                        icon: domain.icon,
                        priority: score < 30 ? "Priorit√© haute" : "Recommand√©",
                        color: domain.color
                    });
                }
            });

            // Recommandations g√©n√©rales
            recommendations.push(
                { title: "Bilan avec conseiller", description: "Rendez-vous personnalis√©", icon: "üë®‚Äçüíº", priority: "Essentiel", color: "purple" },
                { title: "Atelier mobilit√©", description: "Formation pratique", icon: "üéì", priority: "Recommand√©", color: "blue" },
                { title: "Suivi 3 mois", description: "√âvaluation des progr√®s", icon: "üìÖ", priority: "Planifi√©", color: "green" }
            );

            let html = '';
            recommendations.slice(0, 6).forEach(rec => {
                html += `
                    <div class="bg-white border-2 border-${rec.color}-200 rounded-2xl p-6 card-hover">
                        <div class="text-center mb-4">
                            <div class="text-4xl mb-2">${rec.icon}</div>
                            <h4 class="font-bold text-lg text-gray-800">${rec.title}</h4>
                            <p class="text-sm text-gray-600 mb-3">${rec.description}</p>
                            <span class="inline-block px-3 py-1 bg-${rec.color}-100 text-${rec.color}-700 rounded-full text-xs font-semibold">
                                ${rec.priority}
                            </span>
                        </div>
                        <button class="w-full bg-${rec.color}-500 text-white py-2 rounded-lg font-semibold hover:bg-${rec.color}-600 transition-all">
                            En savoir plus
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function getRecommendationForDomain(domainId) {
            const recommendations = {
                geographie: "Optimiser ton environnement de d√©placement",
                transport: "D√©velopper tes moyens de transport",
                competences: "Renforcer tes comp√©tences mobilit√©",
                sante: "Adapter la mobilit√© √† ta sant√©",
                financement: "Optimiser ton budget transport",
                social: "D√©velopper ton r√©seau mobilit√©",
                contraintes: "Surmonter les obstacles",
                projets: "Concr√©tiser tes projets mobilit√©"
            };
            return recommendations[domainId] || "Am√©liorer ce domaine";
        }

        function showReport() {
            document.getElementById('profile-page').classList.add('hidden');
            document.getElementById('report-page').classList.remove('hidden');
            generateAdvancedReport();
        }

        function generateAdvancedReport() {
            const container = document.getElementById('report-content');
            const date = new Date().toLocaleDateString('fr-FR');
            
            let html = `
                <div class="text-center mb-10">
                    <div class="gradient-bg text-white rounded-3xl p-8 mb-8">
                        <h3 class="text-4xl font-montserrat font-bold mb-4">${currentProfile}</h3>
                        <p class="text-xl opacity-90">Diagnostic complet g√©n√©r√© le ${date}</p>
                        <div class="mt-4 text-sm opacity-75">
                            ID Diagnostic: DM360-${Date.now().toString(36).toUpperCase()}
                        </div>
                    </div>
                </div>

                <div class="grid lg:grid-cols-2 gap-8 mb-10">
                    <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-3xl p-8">
                        <h4 class="text-2xl font-montserrat font-bold text-purple-800 mb-6">üìä Synth√®se des scores</h4>
                        ${generateScoresSummary()}
                    </div>

                    <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-3xl p-8">
                        <h4 class="text-2xl font-montserrat font-bold text-purple-800 mb-6">üéØ Points cl√©s</h4>
                        ${generateKeyPoints()}
                    </div>
                </div>

                <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-3xl p-8 mb-8">
                    <h4 class="text-2xl font-montserrat font-bold text-purple-800 mb-6">üöÄ Plan d'action personnalis√©</h4>
                    ${generateActionPlan()}
                </div>

                <div class="bg-yellow-50 border-l-8 border-yellow-400 p-8 rounded-r-3xl">
                    <h4 class="text-2xl font-montserrat font-bold text-yellow-800 mb-4">üìã Prochaines √©tapes</h4>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="font-bold text-yellow-700 mb-2">Imm√©diat (1 semaine)</h5>
                            <ul class="list-disc list-inside space-y-1 text-sm text-yellow-700">
                                <li>Partager ce bilan avec ton conseiller</li>
                                <li>Identifier les aides disponibles</li>
                                <li>Planifier un rendez-vous de suivi</li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="font-bold text-yellow-700 mb-2">Court terme (1 mois)</h5>
                            <ul class="list-disc list-inside space-y-1 text-sm text-yellow-700">
                                <li>S'inscrire aux ateliers recommand√©s</li>
                                <li>D√©marrer les d√©marches prioritaires</li>
                                <li>√âvaluer les progr√®s r√©alis√©s</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function generateScoresSummary() {
            let html = '<div class="space-y-3">';
            
            diagnosticDomains.forEach(domain => {
                const score = Math.round(domainScores[domain.id] || 0);
                let status = '√Ä d√©velopper';
                let colorClass = 'red';
                
                if (score >= 70) { status = 'Excellent'; colorClass = 'green'; }
                else if (score >= 50) { status = 'Correct'; colorClass = 'yellow'; }
                else if (score >= 30) { status = 'Moyen'; colorClass = 'orange'; }
                
                html += `
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <span class="text-lg mr-2">${domain.icon}</span>
                            <span class="font-medium">${domain.title.split(' ')[0]}</span>
                        </div>
                        <div class="text-right">
                            <span class="font-bold text-${colorClass}-600">${score}%</span>
                            <div class="text-xs text-${colorClass}-600">${status}</div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }

        function generateKeyPoints() {
            const scores = Object.values(domainScores);
            const avgScore = scores.reduce((sum, score) => sum + score, 0) / scores.length;
            const strongPoints = diagnosticDomains.filter(domain => domainScores[domain.id] >= 70);
            const weakPoints = diagnosticDomains.filter(domain => domainScores[domain.id] < 40);
            
            return `
                <div class="space-y-4">
                    <div>
                        <h5 class="font-bold text-green-700 mb-2">‚úÖ Points forts</h5>
                        <div class="text-sm text-green-600">
                            ${strongPoints.length > 0 ? strongPoints.map(d => d.title.split(' ')[0]).join(', ') : 'Potentiel √† d√©velopper dans tous les domaines'}
                        </div>
                    </div>
                    <div>
                        <h5 class="font-bold text-orange-700 mb-2">‚ö†Ô∏è Points d'am√©lioration</h5>
                        <div class="text-sm text-orange-600">
                            ${weakPoints.length > 0 ? weakPoints.map(d => d.title.split(' ')[0]).join(', ') : 'Bon niveau g√©n√©ral'}
                        </div>
                    </div>
                    <div>
                        <h5 class="font-bold text-blue-700 mb-2">üìà Score global</h5>
                        <div class="text-2xl font-bold text-blue-600">${Math.round(avgScore)}%</div>
                    </div>
                </div>
            `;
        }

        function generateActionPlan() {
            const weakDomains = diagnosticDomains.filter(domain => domainScores[domain.id] < 50);
            
            let html = '<div class="grid md:grid-cols-2 gap-6">';
            
            // Actions prioritaires
            html += `
                <div>
                    <h5 class="font-bold text-red-700 mb-3">üî• Actions prioritaires</h5>
                    <div class="space-y-2">
            `;
            
            weakDomains.slice(0, 3).forEach(domain => {
                html += `
                    <div class="bg-white rounded-lg p-3 border-l-4 border-red-400">
                        <div class="font-medium">${domain.icon} ${domain.title.split(' ')[0]}</div>
                        <div class="text-sm text-gray-600">${getActionForDomain(domain.id)}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
                <div>
                    <h5 class="font-bold text-blue-700 mb-3">üìÖ Actions √† moyen terme</h5>
                    <div class="space-y-2">
                        <div class="bg-white rounded-lg p-3 border-l-4 border-blue-400">
                            <div class="font-medium">üéì Formation continue</div>
                            <div class="text-sm text-gray-600">D√©velopper tes comp√©tences mobilit√©</div>
                        </div>
                        <div class="bg-white rounded-lg p-3 border-l-4 border-blue-400">
                            <div class="font-medium">üîÑ Suivi r√©gulier</div>
                            <div class="text-sm text-gray-600">√âvaluation trimestrielle des progr√®s</div>
                        </div>
                        <div class="bg-white rounded-lg p-3 border-l-4 border-blue-400">
                            <div class="font-medium">üåü Objectifs long terme</div>
                            <div class="text-sm text-gray-600">Autonomie compl√®te en mobilit√©</div>
                        </div>
                    </div>
                </div>
            `;
            
            html += '</div>';
            return html;
        }

        function getActionForDomain(domainId) {
            const actions = {
                geographie: "Analyser les solutions de transport locales",
                transport: "√âvaluer les options de v√©hicules adapt√©s",
                competences: "Suivre une formation aux outils mobilit√©",
                sante: "Adapter les moyens de transport √† tes besoins",
                financement: "Rechercher les aides financi√®res disponibles",
                social: "D√©velopper un r√©seau d'entraide transport",
                contraintes: "Identifier et lever les obstacles principaux",
                projets: "D√©finir un plan d'action mobilit√© personnalis√©"
            };
            return actions[domainId] || "Am√©liorer ce domaine";
        }

        function downloadAdvancedPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Configuration avanc√©e
            doc.setFont("helvetica");
            
            // Page 1 - En-t√™te et profil
            doc.setFillColor(122, 26, 122);
            doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(32);
            doc.text('Diag\'Mob 360¬∞', 20, 25);
            doc.setFontSize(16);
            doc.text('Diagnostic mobilit√© complet', 20, 35);
            
            // Profil et date
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(24);
            doc.setTextColor(122, 26, 122);
            doc.text(currentProfile, 20, 60);
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`Diagnostic g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}`, 20, 70);
            doc.text(`ID: DM360-${Date.now().toString(36).toUpperCase()}`, 20, 78);
            
            // Scores par domaine
            let yPos = 95;
            doc.setFontSize(18);
            doc.setTextColor(122, 26, 122);
            doc.text('Scores par domaine', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            
            diagnosticDomains.forEach(domain => {
                const score = Math.round(domainScores[domain.id] || 0);
                doc.text(`${domain.title}: ${score}%`, 25, yPos);
                yPos += 8;
            });
            
            // Nouvelle page pour les recommandations
            doc.addPage();
            
            // En-t√™te page 2
            doc.setFillColor(122, 26, 122);
            doc.rect(0, 0, 210, 20, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.text('Plan d\'action personnalis√©', 20, 14);
            
            yPos = 35;
            doc.setFontSize(16);
            doc.setTextColor(122, 26, 122);
            doc.text('Recommandations prioritaires', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            
            const weakDomains = diagnosticDomains.filter(domain => domainScores[domain.id] < 50);
            weakDomains.forEach(domain => {
                doc.text(`‚Ä¢ ${domain.title}: ${getActionForDomain(domain.id)}`, 25, yPos);
                yPos += 8;
            });
            
            yPos += 10;
            doc.setFontSize(16);
            doc.setTextColor(122, 26, 122);
            doc.text('Prochaines √©tapes', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            const steps = [
                'Partager ce bilan avec votre conseiller Mission Locale',
                'Identifier les aides financi√®res disponibles',
                'S\'inscrire aux ateliers recommand√©s',
                'Planifier un suivi dans 3 mois',
                '√âvaluer les progr√®s r√©alis√©s'
            ];
            
            steps.forEach(step => {
                doc.text(`‚Ä¢ ${step}`, 25, yPos);
                yPos += 8;
            });
            
            // Pied de page
            doc.setFontSize(9);
            doc.setTextColor(128, 128, 128);
            doc.text('Document g√©n√©r√© par Diag\'Mob 360¬∞ - Mission Locale', 20, 280);
            doc.text('Diagnostic technique complet pour accompagnement professionnel', 20, 287);
            
            // T√©l√©chargement
            const filename = `diagmob-360-${currentProfile.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}-${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(filename);
        }

        function shareAdvancedReport() {
            const avgScore = Math.round(Object.values(domainScores).reduce((sum, score) => sum + score, 0) / Object.keys(domainScores).length);
            
            const subject = encodeURIComponent(`Bilan Diag'Mob 360¬∞ - ${currentProfile}`);
            const body = encodeURIComponent(`Bonjour,

Je vous transmets mon diagnostic mobilit√© 360¬∞ complet g√©n√©r√© par Diag'Mob.

PROFIL IDENTIFI√â: ${currentProfile}
SCORE GLOBAL: ${avgScore}%
DATE DU DIAGNOSTIC: ${new Date().toLocaleDateString('fr-FR')}
ID DIAGNOSTIC: DM360-${Date.now().toString(36).toUpperCase()}

SCORES PAR DOMAINE:
${diagnosticDomains.map(domain => `‚Ä¢ ${domain.title}: ${Math.round(domainScores[domain.id] || 0)}%`).join('\n')}

DOMAINES PRIORITAIRES √Ä TRAVAILLER:
${diagnosticDomains.filter(domain => domainScores[domain.id] < 50).map(domain => `‚Ä¢ ${domain.title}`).join('\n')}

Ce diagnostic technique complet peut servir de base pour notre prochain entretien et l'√©laboration d'un plan d'accompagnement personnalis√©.

Je reste disponible pour √©changer sur ces r√©sultats.

Cordialement`);
            
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        function exportData() {
            const exportData = {
                profile: currentProfile,
                date: new Date().toISOString(),
                id: `DM360-${Date.now().toString(36).toUpperCase()}`,
                scores: domainScores,
                answers: answers,
                domains: diagnosticDomains.map(d => ({ id: d.id, title: d.title }))
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `diagmob-360-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        function restartDiagnostic() {
            // R√©initialisation compl√®te
            currentDomainIndex = 0;
            currentQuestionInDomain = 0;
            currentQuestionIndex = 0;
            answers = {};
            domainScores = {};
            currentProfile = "";
            
            // Retour √† la page d'accueil
            document.getElementById('report-page').classList.add('hidden');
            document.getElementById('welcome-page').classList.remove('hidden');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ffb2c7351cd682',t:'MTc1ODAxODczMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
